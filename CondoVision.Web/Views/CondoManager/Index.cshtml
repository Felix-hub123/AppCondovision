@@model CondoVision.Models.DashBoardViewModel
@using System.Text.Json

@{
    ViewData["Title"] = "Painel de Administração - CondoVision";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0 text-dark">@ViewData["Title"]</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                        <li class="breadcrumb-item active">Painel de Administração</li>
                    </ol>
                </div>
            </div>
        </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <!-- Mensagem (se houver) -->
            @if (!string.IsNullOrEmpty(ViewData["Message"] as string))
            {
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    @ViewData["Message"]
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            }

            <!-- Small boxes (Opções de Gestor) -->
            <div class="row">
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon bg-info"><i class="fas fa-building"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Gerir Condomínios</span>
                            <a asp-controller="Condominium" asp-action="Index" class="info-box-number text-primary">Acessar</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon bg-success"><i class="fas fa-home"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Gerir Unidades</span> <!-- Atualizado de "Frações" -->
                            <a asp-controller="Unit" asp-action="Index" class="info-box-number text-primary">Acessar</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon bg-warning"><i class="fas fa-users"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Gerir Proprietários</span>
                            <a asp-controller="FractionOwner" asp-action="Index" class="info-box-number text-primary">Acessar</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Distribuição de Entidades -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Distribuição de Entidades</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="myPieChart" style="height: 300px;"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Contagem de Entidades -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Contagem de Entidades</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="myBarChart" style="height: 300px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js" asp-append-version="true"></script>
    <script>
        $(function () {
            var dashboardData = @Html.Raw(JsonSerializer.Serialize(Model, new JsonSerializerOptions { PropertyNamingPolicy = JsonNamingPolicy.CamelCase }));

          
            var ctxPie = document.getElementById('myPieChart').getContext('2d');
            new Chart(ctxPie, {
                type: 'pie',
                data: {
                    labels: ['Condomínios', 'Unidades', 'Proprietários'], 
                    datasets: [{
                        data: [
                            dashboardData.condominiumsCount || 0,
                            dashboardData.unitsCount || 0,
                            dashboardData.fractionOwnersCount || 0
                        ],
                        backgroundColor: ['#007BFF', '#28A745', '#FFC107'],
                        borderColor: ['#0056b3', '#1D8348', '#D4A017'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { font: { size: 14 } } },
                        title: { display: true, text: 'Distribuição de Entidades', font: { size: 18 } }
                    }
                }
            });

            // Gráfico de Barras
            var ctxBar = document.getElementById('myBarChart').getContext('2d');
            new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: ['Condomínios', 'Unidades', 'Proprietários'], 
                    datasets: [{
                        label: 'Quantidade',
                        data: [
                            dashboardData.condominiumsCount || 0,
                            dashboardData.unitsCount || 0,
                            dashboardData.fractionOwnersCount || 0
                        ],
                        backgroundColor: ['#007BFF', '#28A745', '#FFC107'],
                        borderColor: ['#0056b3', '#1D8348', '#D4A017'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Quantidade', font: { size: 14 } },
                            ticks: { font: { size: 12 } }
                        },
                        x: { ticks: { font: { size: 12 } } }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { font: { size: 14 } } },
                        title: { display: true, text: 'Contagem de Entidades', font: { size: 18 } }
                    }
                }
            });
        });
    </script>
}