@model CondoVision.Models.DashBoardViewModel
@using System.Text.Json

@{
    ViewData["Title"] = ViewData["Title"];
}

<h1>@ViewData["Title"]</h1>

<p>@ViewData["Message"]</p>

<div class="card mt-4">
    <div class="card-header">
        Opções de Gestor
    </div>
    <ul class="list-group list-group-flush">
        <li class="list-group-item"><a asp-area="" asp-controller="Condominium" asp-action="Index">Gerir Condomínios</a></li>
        <li class="list-group-item"><a asp-area="" asp-controller="Fraction" asp-action="Index">Gerir Frações</a></li>
        <li class="list-group-item"><a asp-area="" asp-controller="FractionOwner" asp-action="Index">Gerir Proprietários de Frações</a></li>
    </ul>
</div>

<!-- Gráfico de Pizza: Distribuição de Entidades -->
<div class="card mt-4">
    <div class="card-header">
        <h3 class="card-title">Distribuição de Entidades</h3>
    </div>
    <div class="card-body">
        <canvas id="myPieChart" style="height:250px; min-height:250px"></canvas>
    </div>
</div>

<!-- Gráfico de Barras: Contagem de Entidades -->
<div class="card mt-4">
    <div class="card-header">
        <h3 class="card-title">Contagem de Entidades</h3>
    </div>
    <div class="card-body">
        <canvas id="myBarChart" style="height:250px; min-height:250px"></canvas>
    </div>
</div>

@section Scripts {
    <script src="~/AdminLTE/plugins/chart.js/Chart.min.js" asp-append-version="true"></script>
    <script>
        $(function () {
            // Serializar em camelCase para JS
            var dashboardData = @Html.Raw(JsonSerializer.Serialize(Model, new JsonSerializerOptions { PropertyNamingPolicy = JsonNamingPolicy.CamelCase }));

            // Gráfico de Pizza
            var ctxPie = document.getElementById('myPieChart').getContext('2d');
            new Chart(ctxPie, {
                type: 'pie',
                data: {
                    labels: ['Condomínios', 'Frações', 'Proprietários'],
                    datasets: [{
                        data: [
                            dashboardData.condominiumsCount,
                            dashboardData.fractionsCount,
                            dashboardData.fractionOwnersCount
                        ],
                        backgroundColor: ['rgba(54,162,235,0.7)', 'rgba(255,99,132,0.7)', 'rgba(75,192,192,0.7)'],
                        borderColor: ['rgba(54,162,235,1)', 'rgba(255,99,132,1)', 'rgba(75,192,192,1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Distribuição de Entidades' }
                    }
                }
            });

            // Gráfico de Barras
            var ctxBar = document.getElementById('myBarChart').getContext('2d');
            new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: ['Condomínios', 'Frações', 'Proprietários'],
                    datasets: [{
                        label: 'Quantidade',
                        data: [
                            dashboardData.condominiumsCount,
                            dashboardData.fractionsCount,
                            dashboardData.fractionOwnersCount
                        ],
                        backgroundColor: ['rgba(54,162,235,0.7)', 'rgba(255,99,132,0.7)', 'rgba(75,192,192,0.7)'],
                        borderColor: ['rgba(54,162,235,1)', 'rgba(255,99,132,1)', 'rgba(75,192,192,1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, title: { display: true, text: 'Quantidade' } } },
                    plugins: { legend: { position: 'top' } }
                }
            });
        });
    </script>
}

